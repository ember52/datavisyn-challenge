sequenceDiagram
    actor User
    participant Ingress as NGINX Ingress
    participant OAuth as OAuth2 Proxy
    participant KC as Keycloak
    participant FE as Frontend
    participant BE as Backend - FastAPI

    User->>Ingress: GET https://webapp.ember-challenge.test/
    Ingress->>OAuth: auth-url subrequest
    OAuth-->>Ingress: 401 Unauthorized
    Ingress-->>User: 302 Redirect to /oauth2/start

    User->>OAuth: /oauth2/start
    OAuth-->>User: 302 Redirect to Keycloak Login

    User->>KC: Login with username + password
    KC-->>User: 302 Redirect with authorization code

    User->>OAuth: /oauth2/callback?code=...
    OAuth->>KC: Exchange code for tokens
    KC-->>OAuth: ID Token + Access Token
    OAuth-->>User: Set session cookie + 302 Redirect to /

    User->>Ingress: GET / with session cookie
    Ingress->>OAuth: auth-url subrequest
    OAuth-->>Ingress: 200 OK + X-Auth-Request headers
    Ingress->>FE: Forward request
    FE-->>User: Glassmorphism dashboard HTML

    User->>Ingress: GET /api/me via JavaScript fetch
    Ingress->>BE: Forward + X-Auth-Request-User headers
    BE-->>User: JSON identity response
